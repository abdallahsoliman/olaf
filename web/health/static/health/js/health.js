// Generated by CoffeeScript 1.10.0
(function() {
  var height, margin, parseDate, svg, valueLine, width, xAxis, xScale, yAxis, yScale;

  swampdragon.open(function() {
    swampdragon.subscribe('heart-rate', 'heart-rate', null, (function(context, data) {
      console.log("subscribe success");
    }), function(context, data) {
      console.log("subscribe fail");
    });
  });

  swampdragon.close(function() {});

  swampdragon.ready(function() {});

  swampdragon.onChannelMessage(function(channels, message) {
    console.log(channels);
    console.log(message);
  });

  margin = {
    top: 25,
    right: 25,
    bottom: 25,
    left: 25
  };

  width = 800 - margin.left - margin.right;

  height = 400 - margin.top - margin.bottom;

  xScale = d3.time.scale().range([0, width]);

  yScale = d3.scale.linear().range([height, 0]);

  xAxis = d3.svg.axis().scale(xScale).orient('bottom').ticks(10);

  yAxis = d3.svg.axis().scale(yScale).orient('left').ticks(5);

  valueLine = d3.svg.line().x(function(d) {
    return xScale(new Date(d.date));
  }).y(function(d) {
    return yScale(d.value);
  });

  svg = d3.select('#heart-rate-graph').append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', "translate(" + margin.left + "," + margin.top + ")");

  parseDate = d3.time.format("%d-%b-%y").parse;

  xScale.domain(d3.extent(data, function(d) {
    return new Date(d.date);
  }));

  yScale.domain([
    d3.min(data, function(d) {
      return d.value;
    }), d3.max(data, function(d) {
      return d.value;
    })
  ]);

  svg.append('path').attr('class', 'line').attr('d', valueLine(data));

  svg.append('g').attr('class', 'x axis').attr('transform', "translate(0, " + height + ")").call(xAxis);

  svg.append('g').attr('class', 'y axis').call(yAxis);

}).call(this);
